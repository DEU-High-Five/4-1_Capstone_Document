<template>
  <div class="c-app flex-row align-items-center">
    <CContainer>
      <CRow class="justify-content-center">
        <CCol md="8" id="login_body">
            <CCard class="p-4" id="main_login">
              <div id="description_zone">
                <svg  width="150px" height="150px" preserveAspectRatio="none" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" overflow="hidden"><g transform="translate(0.000000,500.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M3730 4340 l0 -530 530 0 530 0 0 530 0 530 -530 0 -530 0 0 -530z m940 0 l0 -410 -410 0 -410 0 0 410 0 410 410 0 410 0 0 -410z"/><path d="M3960 4345 l0 -295 295 0 295 0 0 295 0 295 -295 0 -295 0 0 -295z"/><path d="M230 4330 l0 -530 530 0 530 0 0 530 0 530 -530 0 -530 0 0 -530z m940 0 l0 -410 -410 0 -410 0 0 410 0 410 410 0 410 0 0 -410z"/><path d="M460 4335 l0 -295 295 0 295 0 0 295 0 295 -295 0 -295 0 0 -295z"/><path d="M2870 3745 c-147 -41 -231 -138 -277 -320 -16 -63 -18 -121 -18 -565 0 -545 3 -576 64 -706 70 -151 212 -223 416 -211 239 14 361 134 400 396 22 141 21 922 0 1047 -30 173 -116 296 -243 345 -75 29 -260 36 -342 14z m215 -226 c51 -14 108 -73 129 -135 24 -71 24 -969 0 -1055 -29 -103 -95 -159 -189 -159 -62 0 -105 20 -143 66 -66 80 -67 86 -67 624 0 545 0 542 73 612 57 55 116 69 197 47z"/><path d="M1280 2850 l0 -880 120 0 120 0 2 723 3 722 120 -720 120 -720 117 -3 116 -3 6 28 c3 15 56 336 116 713 61 377 112 690 115 695 2 6 4 -315 4 -712 l1 -723 120 0 120 0 0 880 0 880 -212 -2 -212 -3 -86 -648 c-47 -356 -88 -639 -92 -630 -4 10 -28 198 -53 418 -26 220 -62 504 -81 630 -19 127 -34 231 -34 233 0 1 -97 2 -215 2 l-215 0 0 -880z"/><path d="M3545 3718 c-3 -7 -4 -402 -3 -878 l3 -865 118 -3 117 -3 0 657 c0 362 2 655 6 652 3 -3 67 -295 144 -648 76 -353 143 -647 148 -652 4 -4 82 -7 173 -6 l164 3 0 875 0 875 -122 3 -123 3 -2 -656 -3 -656 -139 613 c-77 337 -143 632 -149 656 l-9 42 -159 0 c-119 0 -161 -3 -164 -12z"/><path d="M4520 2850 l0 -880 120 0 120 0 0 880 0 880 -120 0 -120 0 0 -880z"/><path d="M2338 1935 c-163 -41 -254 -145 -295 -336 -16 -75 -18 -137 -17 -559 0 -403 3 -487 17 -554 54 -257 203 -368 470 -354 162 10 269 72 335 196 63 118 65 137 69 670 3 317 1 508 -6 555 -30 197 -111 311 -260 368 -73 28 -232 35 -313 14z m230 -242 c41 -20 88 -81 102 -134 7 -25 10 -216 8 -536 l-3 -498 -28 -57 c-36 -74 -74 -101 -148 -106 -32 -2 -69 -2 -83 2 -38 9 -85 54 -114 110 l-27 51 -3 507 c-3 497 -2 509 18 557 12 27 34 61 49 76 56 53 151 65 229 28z"/><path d="M1200 1800 l0 -110 135 0 135 0 0 -765 0 -766 123 3 122 3 3 763 2 762 160 0 160 0 0 110 0 110 -420 0 -420 0 0 -110z"/><path d="M2970 1035 l0 -875 120 0 120 0 0 410 0 410 87 0 c127 0 209 -17 247 -50 l31 -28 3 -371 3 -371 125 0 126 0 -5 338 c-2 209 -8 350 -15 372 -22 68 -70 129 -131 168 l-60 38 52 18 c66 23 121 78 138 136 9 31 13 112 14 255 0 239 -9 280 -72 336 -84 73 -177 89 -519 89 l-264 0 0 -875z m555 641 c18 -8 38 -23 44 -34 7 -13 11 -91 11 -200 0 -156 -2 -183 -17 -201 -25 -31 -79 -40 -225 -41 l-128 0 0 245 0 245 140 0 c99 0 151 -4 175 -14z"/><path d="M3823 1896 c3 -7 78 -259 166 -560 l161 -547 0 -314 0 -315 120 0 120 0 0 311 0 311 170 558 c94 306 170 560 170 564 0 3 -55 6 -122 6 l-123 0 -104 -410 c-58 -226 -108 -407 -112 -403 -4 5 -14 42 -24 83 -9 41 -52 222 -96 403 l-81 327 -125 0 c-101 0 -124 -3 -120 -14z"/><path d="M220 690 l0 -530 530 0 530 0 0 530 0 530 -530 0 -530 0 0 -530z m940 0 l0 -410 -410 0 -410 0 0 410 0 410 410 0 410 0 0 -410z"/><path d="M450 695 l0 -295 295 0 295 0 0 295 0 295 -295 0 -295 0 0 -295z"/></g></svg>
                <div id="descript_text_login">
                  <h3 class="bold">모든 물건을 내 손안에!</h3>
                </div>
              </div>
              <CCardBody>
                <CForm>
                  <CInput
                    placeholder="ID"
                    autocomplete="username email"
                    v-model="user.userId"
                    invalid-feedback="ID 입력 형식이 올바르지 않습니다."
                    :is-valid="show_warning"
                  >
                    <template #prepend-content><CIcon name="cil-user"/></template>
                  </CInput>
                  <CInput
                    style="font: small-caption"
                    placeholder="비밀번호"
                    type="password"
                    v-model="user.userPassword"
                    autocomplete="curent-password"
                  >
                    <template #prepend-content><CIcon name="cil-lock-locked"/></template>
                  </CInput>
                  <CRow>
                    <CCol class="text-center">
                      <CButton size="lg" color="primary" block @click="loginSubmit">로그인</CButton>
                    </CCol>
                  </CRow>
                  <!-- <CRow style="margin-top:10px">
                    <CCol class="text-center">
                      <CButton size="lg" color="primary" variant="outline" block @click="loginSubmit">-</CButton>
                    </CCol>
                  </CRow> -->
                  <CRow class="mt-2" style="text-align: center">
                    <CCol>
                      아직 회원이 아니신가요?
                      <CButton color="link" v-bind:style="{fontSize: ftsize() +'px'}" @click="gotoRegister">회원가입</CButton>
                    </CCol>
                  </CRow>
                </CForm>
              </CCardBody>
            </CCard>
        </CCol>
      </CRow>
      <CModal
      :closeOnBackdrop="false"
      title="Modal_3"
      color="white"
      :show.sync="getModalState"
      :centered="true"
    >
      아이디 혹은 비밀번호가 일치하지 않습니다.
      <template #header>
        <h6 class="modal-title">로그인 실패</h6>
        <!-- <CButtonClose @click="showNicknameOverlapModal = false" class="text-white"/> -->
      </template>
      <template #footer>
        <CButton @click="checkModal" color="success">  확인  </CButton>
      </template>
    </CModal>
    </CContainer>
  </div>
</template>

<style scoped>
#login_body{
  overflow: hidden;
  height: 120%;
}
</style>

<script>
import { mapGetters } from "vuex"
export default {
  name: 'Login',
  data() { 
    return {
      warning_id:false,
      showCheckModal: false,
      windowWidth: window.outerWidth,
      user: {
        userId: "", 
        userPassword: "",
      },
      }; 
    }, 
    created() {
      this.$store.commit("registerStore/resetAll")
      this.$store.commit("loginCheck")
    },
    computed:{
      ...mapGetters([
        "getModalState"
      ])
    },
    methods: { 
      aa(){
        console.log(this.$store.state.userStore.loginModal)
      },
      show_warning() {
      if(this.warning_id)
        return false;
      return '';
    },
      input_checker(val){
        var reg1 = /^[a-z0-9]{5,20}$/;
        var reg2 = /[a-z]/g;    
        var reg3 = /[0-9]/g;
        if(reg1.test(val) &&  reg2.test(val) && reg3.test(val)){
          return true;
        }
        else return false;
      },
      checkModal(){
        this.user.userPassword = ''
        this.$store.commit("setLoginModal", false)
      },
      ftsize(){
        if(this.windowWidth > 320)
          return 13
        else
          return 5
      },
      gotoRegister(){
        this.$router.replace({ name: 'Register1' })
      },
      async loginSubmit(e) { 
        e.preventDefault();
        
        if (!this.input_checker(this.user.userId)){
          this.warning_id = true;
          return;
        }

        this.$store.dispatch("login", this.user)



        // const response = await this.$http.post('/api/users/login', {
        //     userId: this.userId,
        //     userPassword: this.userPassword
        //   }).then((res) => {
        //     if(res.data.success == true){
        //       console.log(res.data.token)
        //       this.$router.replace({ name: 'Matching' })
        //     }
        //     if(res.data.success == false){
        //       this.showCheckModal = true;
        //     }
        //   }).catch(function (error){
        //     console.log(error)
        //   })





        // try { 
        //   this.$axios 
        //   .post(HOST + "/register", JSON.stringify(saveData), { 
        //     headers: { 
        //       "Content-Type": `application/json`, 
        //       }, 
        //       }) 
        //       .then((res) => { 
        //         if (res.status === 200) { 
        //           // 로그인 성공시 처리해줘야할 부분 
        //           } 
        //         }); 
        // } catch (error) { 
        //   console.error(error); 
        //   }
          //this.$router.replace({ name: 'Matching' })
      }, 
    }, 
};

</script>